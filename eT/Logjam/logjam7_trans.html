<!DOCTYPE html>
<html lang="en-UK">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <title>eT: Logjam 7/trans</title>
  <link rel="stylesheet" media="screen" href="/eT/css/eT.css" />
  <link rel="stylesheet" media="print" href="/eT/css/eTp.css" />
  <link rel="icon" href="/images/mike.ico" type="image/ico" sizes="16x16">
  <style>
    .switch {
      position: relative;
      display: inline-block;
      width: 60px;
      height: 34px;
    }

    .switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }

    .slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: red;
      transition: .4s;
    }

    .slider:before {
      position: absolute;
      content: "";
      height: 26px;
      width: 26px;
      left: 4px;
      bottom: 4px;
      background: white;
      transition: .4s;
    }

    input:checked + .slider {
      background-color: green;
    }

    input:checked + .slider:before {
      transform: translateX(26px);
    }

    .scaler {
      width: 2000px;
      height: 260px;
      text-align: center;
      position: relative;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%);
      transform-origin: center center;
      background:orange;
    }

    .wrapper {
      position: relative;
      background: gray;
    }
    .rulespace {
      display: block;
      position:relative;
      background: green;
      width: 2000px;
      height:auto;
    }
    .rule {
      display: block;
      margin: auto;
      width: 1050px;
      height:70px;
    }
    .zl {
      margin: auto;
      width: 0px;
      border-right: 1px solid red;
      border-left: 1px solid red;
      height: 160px;
    }
    .glass {
      width: 100px;
      height: 160px;
      border: 2px solid black;
      background: grey;
      opacity: 0.2;
      position: absolute;
      top: 0;
      left:10px;
    }

    .zotblk {
      position: absolute;
      display: block;
      z-index: 20;
      width: 40px;
      font-size:medium;
      text-align: center;
      top:-10px;
      left:480px;
    }
    .run {
      display: block;
      width: 120px;
      text-align: center;
      white-space: nowrap;
      position:absolute;
      top:-10px;
      left:940px;
    }
    .rule::selection {
      background-color: transparent;
      color: #000;
    }

    .itext {
      font-size: large;
      user-select:none;
    }

    .iStrip {
      width:2000px;
      height:75px;
      background:transparent;
    }

  </style>
</head>

<body>
  <header><span class="exponential">e<em><sup>x</sup>ponential</em></span> Times</header>
  <script src="/eT/nav.js"></script>
  <div class="pointer"><a href="/eT/Logjam/logjam6.html">◀ Previous</a></div>
  <article>
    <h4 id="rHead">Adder/subtractor</h4>

    <div class="arial" style="text-align:center;padding:10px;">
      <p>
        <span id="addsub" style="font-weight:bold;">Add/subtract</span>
        <label class="switch">
          <input id="switch" type="checkbox" onchange="changeRule()">
          <span class="slider"></span>
        </label>
        <span id="muldiv" style="font-weight:normal;">Multiply/divide</span>
      </p>
    </div>

    <div class="wrapper" id="wrapper">

      <div class="scaler" id="scaler">
        <div style="height:20px"></div>
        <div class="rulespace" id="rs">
          <div id="sblk">
            <img src="linear.svg" alt="rule.svg" draggable="false" class="rule" id="slide" />
            <div id="zblk" class="zotblk">
              <div class="zl"></div>
              <div id="info" class="itext"></div>
            </div>
            <div id="tblk" class="zotblk" style="left:1480px;">
              <div class="zl"></div>
              <div id="tinfo" class="itext"></div>
            </div>
          </div>

          <img src="linear.svg" alt="rule.svg" draggable="false" class="rule" id="fixed" />

          <div id="rblk" class="run">
            <div class="zl"></div>
            <div class="glass"></div>
            <div id="add" class="itext"></div>
          </div>

        </div>

        <div class="iStrip"></div>

      </div>

    </div>

    <script>

      function changeRule() {
        var vSwitch=switchButton.checked;
        if(vSwitch){
          document.getElementById("rHead").innerText="Multiply/divide";
          document.getElementById("addsub").style.fontWeight="normal";
          document.getElementById("muldiv").style.fontWeight="bold";
          document.getElementById("fixed").src="log.svg";
          document.getElementById("slide").src="log.svg";
          ten.style.display="block";
          rConvert= (x) => Math.pow(10,x/1000);
          addmul = "× ";
          subdiv = " / "
        }else{
          document.getElementById("rHead").innerText="Add/subtract";
          document.getElementById("addsub").style.fontWeight="bold";
          document.getElementById("muldiv").style.fontWeight="normal";
          document.getElementById("fixed").src="linear.svg";
          document.getElementById("slide").src="linear.svg";
          ten.style.display="none";
          rConvert = (x) => x/50;
          addmul = "+ ";
          subdiv = " – ";
        }
        readings();
      }

      function getX(e) {
        var type = e.type;
        if(type=="touchstart"||type=="touchmove") {return  e.touches[0].clientX/scale}
        return e.clientX/scale
      }

      function move(item,x) {item.style.transform="translate("+x+"px)"}

      function moveSlide(dX) {
        tRule+=dX;
        move(slide,tRule);
      }

      function moveRunner(dX) {
        tRun+=dX;
        move(runner,tRun);
      }

      function slideStart(e) {
        activeItem = slide;
        dStart=getX(e);
        active = true;
      }

      function runnerStart(e) {
        activeItem = runner;
        dStart = getX(e);
        console.log(e.offsetX);
        active=true;
      }

      function drag(e) {
        if(active) {
          e.preventDefault();
          dNext = getX(e);
          if(activeItem==slide) {moveSlide(dNext-dStart)} else {moveRunner(dNext-dStart)};
          dStart = dNext;
        }
        readings();
      }

      function dragEnd(e) {
        active = false;
        readings();
      }

      function readings() {
        var refzero = rConvert(tRule);
        var reften = rConvert(tRule+1000);
        var result = rConvert(tRun+500);
        var run = rConvert(tRun-tRule+500);
        document.getElementById("info").innerHTML = refzero.toFixed(2) + "<br />" + refzero.toFixed(2);
        document.getElementById("tinfo").innerHTML = (reften).toFixed(2) + "<br />" + (reften).toFixed(2);
        document.getElementById("add").innerHTML= addmul+run.toFixed(2)+" = "+result.toFixed(2)+"<br />"+"= "+result.toFixed(2)+subdiv+run.toFixed(2);
      }

      var slide = document.getElementById("sblk");
      var space = document.getElementById("rs");
      var switchButton = document.getElementById("switch");
      switchButton.checked = false;
      var tRule=0,tRun=0;active=false;
      var dStart, dNext, activeItem, rConvert=(x)=>x/50, addmul="+ ", subdiv=" – ";
      var zero = document.getElementById("zblk"); // set up zero line
      var ten = document.getElementById("tblk"); // set up ten line
      ten.style.display="none";
      var runner = document.getElementById("rblk"); // set up runner/glass
      readings();
      slide.addEventListener("touchstart", slideStart, false);
      slide.addEventListener("mousedown", slideStart, false);
      space.addEventListener("touchmove", drag, false);
      space.addEventListener("mousemove", drag, false);
      window.addEventListener("touchend", dragEnd, false);
      window.addEventListener("mouseup", dragEnd, false);
      runner.addEventListener("touchstart", runnerStart, false);
      runner.addEventListener("mousedown", runnerStart, false);
      var wrap=document.getElementById("wrapper");
      var object=document.getElementById("scaler");
      var scale=wrap.offsetWidth/object.offsetWidth;
      wrap.style.height=scale*object.offsetHeight+"px";
      object.style.transform="translate(-50%,-50%) scale("+scale+","+scale+")";
    </script>
  </body>
  </html>